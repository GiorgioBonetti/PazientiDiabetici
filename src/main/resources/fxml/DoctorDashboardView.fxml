<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox spacing="12" stylesheets="@../css/app.css" xmlns="http://javafx.com/javafx/17.0.12"
      xmlns:fx="http://javafx.com/fxml/1" fx:controller="it.univr.diabete.controller.DoctorDashboardController">

    <!-- Titolo pagina -->
    <VBox spacing="2">
        <HBox alignment="CENTER_LEFT" spacing="6">
            <Label styleClass="page-title" text="Dashboard"/>
        </HBox>
    </VBox>

    <!-- KPI row -->
    <HBox spacing="12" styleClass="kpi-row">
        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS">
            <Label styleClass="kpi-label" text="Pazienti in carico"/>
            <Label fx:id="totalPatientsLabel" styleClass="kpi-value" text="24"/>
            <Label styleClass="kpi-helper" text="± rispetto a settimana scorsa"/>
        </VBox>

        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS">
            <Label styleClass="kpi-label" text="Allarmi attivi"/>
            <Label fx:id="activeAlertsLabel" styleClass="kpi-value" text="4"/>
            <Label styleClass="kpi-helper" text="Valori glicemici fuori soglia"/>
        </VBox>

        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS">
            <Label styleClass="kpi-label" text="Misurazioni oggi"/>
            <Label fx:id="todayVisitsLabel" styleClass="kpi-value" text="5"/>
            <Label styleClass="kpi-helper" text="Misure registrate oggi"/>
        </VBox>

        <VBox styleClass="kpi-card" HBox.hgrow="ALWAYS">
            <Label styleClass="kpi-label" text="Messaggi non letti"/>
            <Label fx:id="unreadMessagesLabel" styleClass="kpi-value" text="2"/>
            <Label styleClass="kpi-helper" text="Ultime 24 ore"/>
        </VBox>
    </HBox>

    <!-- Main grid -->
    <HBox spacing="16" VBox.vgrow="ALWAYS">
        <!-- Colonna sinistra: allarmi + agenda -->
        <VBox prefHeight="300" styleClass="card" HBox.hgrow="ALWAYS">
            <!-- Card allarmi -->
            <BorderPane styleClass="card">
                <VBox.margin>
                    <Insets bottom="24" left="16" right="16" top="20"/>
                </VBox.margin>
                <top>
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="card-header">
                        <Label styleClass="card-title" text="Allarmi pazienti"/>
                        <Label fx:id="alertsCountBadge" styleClass="chip-alert" text="3"/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <ChoiceBox fx:id="alertsFilter" prefWidth="140" styleClass="field-control"/>
                    </HBox>
                </top>
                <center>
                    <TableView fx:id="alertsTable" prefHeight="180" styleClass="table-card">
                        <columns>
                            <TableColumn fx:id="colAlertPatient" prefWidth="150" text="Paziente"/>
                            <TableColumn fx:id="colAlertValue" prefWidth="90" text="Valore"/>
                        <TableColumn fx:id="colAlertDetail" prefWidth="180" text="Sintomo"/>
                            <TableColumn fx:id="colAlertTime" text="Ora"/>
                            <TableColumn fx:id="colAlertPriority" prefWidth="90" text="Priorità"/>
                        </columns>
                    </TableView>
                </center>
            </BorderPane>

            <!-- CARD: Pazienti poco attivi -->
            <BorderPane styleClass="card">
                <VBox.margin>
                    <Insets bottom="24" left="16" right="16"/>
                </VBox.margin>
                <top>
                    <HBox alignment="CENTER_LEFT" spacing="8" styleClass="card-header">
                        <Label styleClass="card-title" text="Pazienti poco attivi"/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <!-- in futuro: filtro "Oltre 3 giorni / 7 giorni / 14 giorni" -->
                    </HBox>
                </top>

                <center>
                    <TableView fx:id="lowActivityTable" prefHeight="220" styleClass="rounded-table">
                        <columns>
                            <TableColumn fx:id="colLowActPatient" prefWidth="180" text="Paziente"/>
                            <TableColumn fx:id="colLowActLastValue" prefWidth="120" text="Ultima glicemia"/>
                            <TableColumn fx:id="colLowActLastDate" prefWidth="150" text="Ultima misura"/>
                            <TableColumn fx:id="colLowActDaysAgo" prefWidth="90" text="Giorni fa"/>
                        </columns>
                    </TableView>
                </center>
            </BorderPane>
        </VBox>

        <!-- CARD: Pazienti -->
        <BorderPane styleClass="card">
            <top>
                <HBox alignment="CENTER_LEFT" spacing="8" styleClass="card-header">
                    <Label styleClass="card-title" text="Pazienti"/>
                    <Pane HBox.hgrow="ALWAYS"/>
                    <TextField fx:id="patientSearchField" promptText="Cerca per nome o codice"
                               styleClass="field-control"/>
                </HBox>
            </top>

            <center>
                <ListView fx:id="patientsListView" prefHeight="400.0"
                          style="-fx-background-color: transparent; -fx-padding: 4;"/>
            </center>
        </BorderPane>
    </HBox>

</VBox>
